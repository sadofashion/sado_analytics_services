version: 2
models:
  - name: sales_dashboard
    meta:
      joins:
        - join: calendar
          sql_on: ${calendar.date} = ${sales_dashboard.date}
        - join: dim__branches
          sql_on: |
            ${dim__branches.branch_id} = ${sales_dashboard.branch_id}
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - branch_id
            - date
    columns:
      - name: val_transaction_id
        data_type: int64
        description: số lượng giao dịch
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_num_transactions:
              type: sum
              label: No. Transactions
              group_label: Sales metrics
              round: 0
      - name: num_invoice_transaction_id
        data_type: int64
        description: số lượng invoice
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_num_invoices:
              type: sum
              label: No. Invoices
              group_label: Sales metrics
              round: 0
            m_num_invoices_psd:
              type: number
              label: No. Invoices PSD
              group_label: Sales metrics
              sql: safe_divide(${m_num_invoices},${m_num_stores})
              round: 2
            m_aov:
              type: number
              sql: safe_divide(${m_invoice_val},${m_num_invoices})
              label: AOV
              group_label: Sales metrics
              round: 0
      - name: num_return_transaction_id
        data_type: int64
        description: số lượng trả
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_num_returns:
              type: sum
              label: No. Returns
              group_label: Sales metrics
              round: 0
            m_return_rate:
              type: number
              sql: safe_divide(${m_num_returns},${m_num_transactions})
              label: Return Rate
              group_label: Sales metrics
              format: percent
              round: 1
      - name: val_total
        data_type: float64
        description: giá trị giao dịch
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_transaction_val:
              type: sum
              label: Transaction Value
              group_label: Sales metrics
              compact: millions
              round: 1
      - name: num_invoice_total
        data_type: float64
        description: giá trị bán
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_invoice_val:
              type: sum
              label: Invoice Value
              group_label: Sales metrics
              compact: millions
              round: 1
      - name: num_return_total
        data_type: float64
        description: giá trị trả
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_return_val:
              type: sum
              label: Return Value
              group_label: Sales metrics
              compact: millions
              round: 1
      - name: val_total_payment
        data_type: float64
        description: doanh thu thuần
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_payment_val:
              type: sum
              label: Payment
              group_label: Sales metrics
              compact: millions
              round: 1
            m_run_rate:
              label: Sales Run rate
              group_label: Sales metrics
              type: number
              sql: safe_divide(${m_payment_val},${m_sales_target})
              format: percent
              round: 2
            m_payment_psd:
              label: Revenue PSD
              group_label: Sales metrics
              type: number
              sql: safe_divide(${m_payment_val},${m_num_stores})
              compact: millions
              round: 2
      - name: num_invoice_total_payment
        data_type: float64
        description: doanh thu thuần bán hàng
        meta:
          dimension:
            type: number
            hidden: true
      - name: num_return_total_payment
        data_type: float64
        description: doanh thu thuần trả hàng
        meta:
          dimension:
            type: number
            hidden: true
      - name: daily_budget
        data_type: float64
        description: ngân sach/ngày
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_ads_budget:
              type: sum
              label: Budget
              group_label: Budget
              compact: millions
              round: 1
      - name: daily_sales_target
        data_type: float64
        description: target sales/ngày
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_sales_target:
              type: sum
              label: Sales target
              group_label: Budget
              compact: millions
              round: 1
      - name: daily_traffic_target
        data_type: float64
        description: target traffic/ngày
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_traffic_target:
              type: sum
              label: Traffic target
              group_label: Budget
              round: 0
      - name: date
        description: Ngày
        meta:
          dimension:
            type: date
            hidden: true
      - name: branch_id
        description: Mã CH
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_num_operating_days:
              type: count_distinct
              sql: ${TABLE}.date||${TABLE}.branch_id
              label: No. Operating Days
              group_label: Misc
              round: 0
      - name: num_stores
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_num_stores:
              type: sum
              label: No. Days with Revenue
              group_label: Misc
              round: 0
    description: >-
      The sales_dashboard model combines offline sales performance data with
      budget data to provide a comprehensive view of branch-level sales
      performance.
