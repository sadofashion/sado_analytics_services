version: 2
models:
  - name: sms_dashboard
    description: ""
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sent_time
            - segment
            - previous_segment
            - sms_id
    meta:
      joins:
        - join: calendar
          sql_on: ${calendar.date} = ${sms_dashboard.sent_time}
        - join: dim__sms_campaigns
          sql_on: ${dim__sms_campaigns.sms_id} = ${sms_dashboard.sms_id}
    columns:
      - name: segment
        description: ""
        meta:
          dimension:
            type: string
      - name: campaign
        description: ""
        meta:
          dimension:
            type: string
      - name: previous_segment
        description: ""
        meta:
          dimension:
            type: string
      - name: sms_sent
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_sms_sent:
              type: sum
              label: No. SMS sent
              round: 0
      - name: customer_sent
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_customer_sent:
              type: sum
              label: No. customer sent
              round: 0
      - name: sms_cost
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_sms_cost:
              type: sum
              label: SMS Cost
              compact: thousands
              round: 1
      - name: total
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_sms_revenue:
              type: sum
              label: SMS Revenue
              compact: thousands
              round: 1
            m_sms_roi:
              type: number
              label: SMS ROI
              sql: safe_divide(${m_sms_revenue},${m_sms_cost})
              round: 2
      - name: num_customer_converted
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_customer_converted:
              type: sum
              label: No. Customer converted
              round: 0
            m_customer_conversion_rate:
              type: number
              label: Customer conversion rate
              sql: safe_divide(${m_customer_converted},${m_customer_sent})
              format: percent
              round: 2
      - name: sent_time
        description: ""
        meta:
          dimension:
            type: date
            hidden: true
      - name: sms_id
        description: ""
        data_type: int64
        meta:
          dimension:
            type: number
            hidden: true
