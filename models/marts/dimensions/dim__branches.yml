version: 2
models:
  - name: dim__branches
    columns:
      - name: asm_name
        description: ""
        meta:
          dimension:
            type: string
        data_type: STRING
      - name: branch_id
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
        data_type: NUMERIC
      - name: branch_name
        description: ""
        meta:
          dimension:
            type: string
          additional_dimensions:
            d_source:
              type: string
              sql: |
                case when ${channel} = 'Offline' then ${asm_name} 
                when ${channel} = 'Online & Ecom' and ${branch_name} in ('Website','FB - WEB') then 'Website'
                when ${channel} = 'Online & Ecom' and ${branch_name} in ('Facebook','Instagram') then 'Social'
                when ${channel} = 'Online & Ecom' and ${branch_name} in ('Tiktok Shop','Lazada.vn','Shopee.vn','Tiki.vn','Sàn','Zalo Shop') then 'Sàn'
                else ${branch_name} end
              label: Source
        data_type: STRING
      - name: phone
        description: ""
        meta:
          dimension:
            type: string
            hidden: true
        data_type: STRING
      - name: email
        description: ""
        meta:
          dimension:
            type: string
            hidden: true
        data_type: STRING
      - name: local_page
        description: ""
        meta:
          dimension:
            type: string
        data_type: STRING
      - name: region_page
        description: ""
        meta:
          dimension:
            type: string
        data_type: STRING
      - name: fb_ads_pic
        description: ""
        meta:
          dimension:
            type: string
        data_type: STRING
      - name: province
        description: ""
        meta:
          dimension:
            type: string
          additional_dimensions:
            d_province:
              type: string
              sql: case when ${province} is null then 'Chưa phân loại' else ${province} end
              label: Province group
        data_type: STRING
      - name: region
        description: ""
        meta:
          dimension:
            type: string
          additional_dimensions:
            d_region:
              type: string
              sql: case when ${region} is null then 'Chưa phân loại' else ${region} end
              label: Region group
        data_type: STRING
      - name: channel
        description: ""
        meta:
          dimension:
            type: string
      - name: opening_day
        description: ""
        meta:
          dimension:
            type: date
          additional_dimensions:
            d_store_age:
              type: string
              sql: |
                case when date_diff(current_date,${opening_day},month) < 3 then '1. under 3M'
                when date_diff(current_date,${opening_day},month) between 3 and 5 then '2. 3-6M'
                when date_diff(current_date,${opening_day},month) between 6 and 8 then '3. 6-9M'
                when date_diff(current_date,${opening_day},month) between 9 and 11 then '4. 9-12M'
                when date_diff(current_date,${opening_day},month) between 12 and 17 then '5. 1-1.5Y'
                when date_diff(current_date,${opening_day},month) between 18 and 23 then '6. 1.5-2Y'
                when date_diff(current_date,${opening_day},month) between 24 and 35 then '7. 2-3Y'
                else '8. over 3Y' end
              label: Store age group
      - name: close_date
        description: ""
        meta:
          dimension:
            type: date
    description: Tổng hợp CH Online & Offline
