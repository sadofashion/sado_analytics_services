version: 2
models:
  - name: dim__branches
    columns:
      - name: branch_id
        description: This is a unique identifier for each branch. It is used to
          distinguish between different branches in the database.
        data_type: numeric
        quote: true
      - name: branch_name
        description: This is the name of the branch. It provides a human-readable
          identifier for each branch and is used in various reports and
          analyses.
        meta:
          additional_dimensions:
            d_source:
              type: string
              sql: |
                case when ${channel} = 'Offline' then ${asm_name} 
                when ${channel} = 'Online & Ecom' and ${branch_name} in ('Website','FB - WEB') then 'Website'
                when ${channel} = 'Online & Ecom' and ${branch_name} in ('Facebook','Instagram') then 'Social'
                when ${channel} = 'Online & Ecom' and ${branch_name} in ('Tiktok Shop','Lazada.vn','Shopee.vn','Tiki.vn','Sàn','Zalo Shop') then 'Sàn'
                else ${branch_name} end
              label: Source
        data_type: string
        quote: true
      - name: branch_code
        data_type: string
        quote: true
      - name: channel
        description: This column indicates the channel through which the branch
          operates. It can be either 'Offline' for physical branches or 'Online
          & Ecom' for online sales channels.
        data_type: string
        quote: true
      - name: asm_name
        meta:
          dimension:
            type: string
        data_type: string
        description: The name of the Area Sales Manager (ASM) associated with the
          branch. If the ASM name is not available, the value will be 'Kho & CH
          khác Kiotviet' for offline channels and 'Online' for online channels.
      - name: phone
        meta:
          dimension:
            type: string
            hidden: true
        data_type: string
        description: The phone number associated with the branch. This field may be null
          for online channels.
      - name: email
        meta:
          dimension:
            type: string
            hidden: true
        data_type: string
      - name: local_page
        meta:
          dimension:
            type: string
        data_type: string
      - name: region_page
        meta:
          dimension:
            type: string
        data_type: string
      - name: fb_ads_pic
        data_type: string
        quote: true
      - name: province
        meta:
          dimension:
            type: string
          additional_dimensions:
            d_province:
              type: string
              sql: case when ${province} is null then 'Chưa phân loại' else ${province} end
              label: Province group
        data_type: string
        description: The 'province' column represents the province where the branch is
          located. It is a string type column and can contain any valid string
          value representing the name of the province.
      - name: province_code
        data_type: string
        quote: true
      - name: region
        meta:
          dimension:
            type: string
          additional_dimensions:
            d_region:
              type: string
              sql: case when ${region} is null then 'Chưa phân loại' else ${region} end
              label: Region group
        data_type: string
        description: The 'region' column represents the region where the branch is
          located. It is a string type column and can contain any valid string
          value representing the name of the region.
      - name: region_code
        data_type: string
        quote: true
      - name: opening_day
        meta:
          dimension:
            type: date
          additional_dimensions:
            d_store_age_group:
              type: string
              sql: >
                case when date_diff(current_date,${opening_day},month) < 3 then
                '1. under 3M'
                when date_diff(current_date,${opening_day},month) between 3 and
                5 then '2. 3-6M'
                when date_diff(current_date,${opening_day},month) between 6 and
                8 then '3. 6-9M'
                when date_diff(current_date,${opening_day},month) between 9 and
                11 then '4. 9-12M'
                when date_diff(current_date,${opening_day},month) between 12 and
                17 then '5. 1-1.5Y'
                when date_diff(current_date,${opening_day},month) between 18 and
                23 then '6. 1.5-2Y'
                when date_diff(current_date,${opening_day},month) between 24 and
                35 then '7. 2-3Y'
                else '8. over 3Y' end
              label: Store age group
            d_store_age:
              type: number
              sql: date_diff(current_date,${opening_day},month)
              label: Store age
        data_type: date
        description: The 'opening_day' column represents the date when the branch was
          opened. It is a date type column and can contain any valid date value
          in the format 'YYYY-MM-DD'.
      - name: close_date
        meta:
          dimension:
            type: date
        data_type: date
        description: The 'close_date' column represents the date when the branch was
          closed. The data type of this column is 'date'. If the branch is still
          operational, this field may be null.
    description: Tổng hợp CH Online & Offline
