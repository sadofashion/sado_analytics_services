version: 2
models:
  - name: revenue_payments
    description: ""
    meta:
      joins:
        - join: calendar
          sql_on: ${calendar.date} = date(revenue_payments.transaction_date)
    columns:
      - name: transaction_id
        description: ""

      - name: transaction_code
        description: ""

      - name: reference_transaction_id
        description: ""

      - name: transaction_date
        description: ""

      - name: transaction_status
        description: ""

      - name: payment_id
        description: ""

      - name: payment_code
        description: ""

      - name: payment_status
        description: ""

      - name: payment_date
        description: ""

      - name: payment_amount
        description: ""

      - name: payment_method
        description: ""

      - name: bankaccount_id
        description: ""

      - name: transaction_type
        description: ""

semantic_models:
  - name: revenue_payments
    defaults:
      agg_time_dimension: transaction_date
    description: "payments for revenue with each payment_id associate with a transaction"
    model: ref('revenue_payments')
    entities:
      - name: transaction_payment
        expr: concat(transaction_id, '.',payment_id)
        type: primary
      - name: branch
        type: foreign
        expr: branch_id
      - name: customer
        type: foreign
        expr: customer_id
      - name: employee
        type: foreign
        expr: employee_id
    dimensions:
      - name: transaction_date
        expr: date(transaction_date)
        type: time
        type_params:
          time_granularity: day
      - name: payment_date
        expr: date(payment_date)
        type: time
        type_params:
          time_granularity: day
      - name: transaction_type
        expr: transaction_type
        type: categorical
      - name: payment_method
        expr: payment_method
        type: categorical
      - name: payment_status
        expr: payment_status
        type: categorical
    measures:
      - name: num_payments
        description: no payments
        agg: count_distinct
        expr: concat(transaction_id,'.',payment_id)
      - name: payment_value
        description: total payments
        agg: sum
        expr: payment_amount
metrics:
  - name: income_payment
    type: simple
    label: Total payment for invoice
    type_params:
      measure: payment_value
    filter: |
      {{Dimension('transaction_payment__transaction_type')}} = 'invoice'
  - name: return_payment
    type: simple
    label: Total payment for return
    type_params:
      measure: payment_value
    filter: |
      {{Dimension('transaction_payment__transaction_type')}} = 'return'
  - name: num_income_payment
    type: simple
    label: Number payments for invoice
    type_params:
      measure: num_payments
    filter: |
      {{Dimension('transaction_payment__transaction_type')}} = 'invoice'
  - name: num_return_payment
    type: simple
    label: Number payments for return
    type_params:
      measure: num_payments
    filter: |
      {{Dimension('transaction_payment__transaction_type')}} = 'return'
