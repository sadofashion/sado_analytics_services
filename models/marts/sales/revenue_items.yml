version: 2
models:
  - name: revenue_items
    description: ""
    meta:
      joins:
        - join: stg_kiotviet__branches
          sql_on: ${stg_kiotviet__branches.branch_id} = ${revenue_items.branch_id}
        - join: stg_kiotviet__customers
          sql_on: ${stg_kiotviet__customers.customer_id} = ${revenue_items.customer_id}
        - join: stg_kiotviet__users
          sql_on: ${stg_kiotviet__users.user_id} =${revenue_items.employee_id}
        - join: calendar
          sql_on: ${calendar.date} = date(revenue_items.transaction_date)
        - join: revenue
          sql_on: ${revenue_items.transaction_id} = ${revenue.transaction_id}
    columns:
      - name: transaction_id
        description: ""

      - name: transaction_code
        description: ""

      - name: reference_transaction_id
        description: ""

      - name: transaction_date
        description: ""

      - name: transaction_status
        description: ""

      - name: branch_id
        description: ""

      - name: employee_id
        description: ""

      - name: customer_id
        description: ""

      - name: product_id
        description: ""

      - name: product_code
        description: ""

      - name: quantity
        description: ""
        meta:
          metrics:
            m_item_sold:
              type: sum
              label: "Num Items Sold"
              group_label: Sales Metrics
              compact: thousands
              round: 1
              filters:
                - transaction_type: invoice
                - subtotal: "> 0"
            m_item_return:
              type: sum
              label: "Num Items Return"
              group_label: Sales Metrics
              compact: thousands
              round: 1
              filters:
                - transaction_type: return

      - name: price
        description: ""

      - name: discount_ratio
        description: ""

      - name: discount
        description: ""
        meta: 
          metrics:
            m_item_discount_value:
              type: sum
              label: Value discount on Items
              group_label: Sales Metrics
              filters:
                - transaction_type: invoice
              compact: millions
              round: 1

      - name: subtotal
        description: ""
        meta:
          metrics:
            m_item_value:
              type: sum
              label: Item Value
              group_label: Sales Metrics
              compact: billions
              round: 1
              filters:
                - transaction_type: invoice
          dimension:
            type: number

      - name: transaction_type
        description: ""
