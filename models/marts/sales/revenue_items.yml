version: 2
models:
  - name: revenue_items
    description: ""
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_id
            - product_id
            - price
    meta:
      joins:
        - join: dim__branches
          sql_on: ${dim__branches.branch_id} = ${revenue_items.branch_id}
        - join: dim__inventory_items
          sql_on: ${dim__inventory_items.kiotviet_product_id} = ${revenue_items.product_id}
        - join: calendar
          sql_on: ${calendar.date} = date(revenue_items.transaction_date)
        - join: revenue
          sql_on: ${revenue_items.transaction_id} = ${revenue.transaction_id}
    columns:
      - name: transaction_id
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
        data_type: BIGNUMERIC
      - name: transaction_code
        description: ""
        meta:
          dimension:
            type: string
        data_type: STRING
      - name: reference_transaction_id
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
        data_type: NUMERIC
      - name: transaction_date
        description: ""
        meta:
          dimension:
            type: timestamp
            hidden: true
        data_type: TIMESTAMP
      - name: transaction_status
        description: ""
        meta:
          dimension:
            type: string
        data_type: STRING
      - name: branch_id
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
        data_type: NUMERIC
      - name: employee_id
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
        data_type: BIGNUMERIC
      - name: customer_id
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
        data_type: BIGNUMERIC
      - name: product_id
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
        data_type: BIGNUMERIC
      - name: product_code
        description: ""
        meta:
          dimension:
            type: string
            hidden: true
        data_type: STRING
      - name: price
        description: ""
        meta:
          dimension:
            type: number
        data_type: FLOAT64
      - name: transaction_type
        description: ""
        meta:
          dimension:
            type: string
        data_type: STRING
      - name: quantity
        description: ""
        meta:
          metrics:
            m_item_sold:
              type: sum
              label: Num Items Sold
              group_label: Sales Metrics
              compact: thousands
              round: 1
              filters:
                - transaction_type: invoice
                - subtotal: "> 0"
            m_item_return:
              type: sum
              label: Num Items Return
              group_label: Sales Metrics
              compact: thousands
              round: 1
              filters:
                - transaction_type: return
          dimension:
            type: number
      - name: price
        description: ""
        meta:
          dimension:
            type: number
      - name: discount_ratio
        description: ""
        meta:
          dimension:
            type: number
        data_type: FLOAT64
      - name: discount
        description: ""
        meta:
          metrics:
            m_item_discount_value:
              type: sum
              label: Value discount on Items
              group_label: Sales Metrics
              filters:
                - transaction_type: invoice
              compact: millions
              round: 1
          dimension:
            type: number
        data_type: FLOAT64
      - name: subtotal
        description: ""
        meta:
          metrics:
            m_item_value:
              type: sum
              label: Item Value
              group_label: Sales Metrics
              compact: millions
              round: 1
              filters:
                - transaction_type: invoice
          dimension:
            type: number
      - name: transaction_type
        description: ""
        meta:
          dimension:
            type: string
