version: 2
models:
  - name: fct__construction_estimates
    columns:
      - name: project_id
        description: ""
        meta:
          dimension:
            type: string
          metrics:
            m_num_projects:
              type: count_distinct
              label: Num Projects
      - name: branch_name
        description: ""
        meta:
          dimension:
            type: string
            label: Project Name
      - name: asm
        description: ""
        meta:
          dimension:
            type: string
      - name: created_at
        description: ""
        meta:
          dimension:
            type: string
      - name: province
        description: ""
        meta:
          dimension:
            type: string
      - name: cost_category
        description: ""
        meta:
          dimension:
            type: string
      - name: actual
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_actual:
              type: sum
              label: Actual cost
              compact: millions
              round: 0
              filters:
                - cost_category: "!total"
            m_avg_cost_per_project:
              type: number
              label: Avg cost per project
              compact: millions
              sql: safe_divide(${m_actual},${m_num_projects})
              round: 1
            m_pct_overrun:
              type: number
              label: "% Overrun"
              sql: safe_divide(${m_actual},${m_estimate}) - 1
              format: percent
              round: 2
      - name: estimate
        description: ""
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_estimate:
              type: sum
              label: Estimated cost
              compact: millions
              round: 0
              filters:
                - cost_category: "!total"
      - name: area_sqm
        description: ""
        meta:
          dimension:
            type: number
          metrics:
            m_total_area:
              type: sum
              label: Total Area
              round: 0
              sql: ${TABLE}.area_sqm/6
            m_avg_area_per_project:
              type: number
              label: Avg Area per project
              sql: safe_divide(${m_total_area},${m_num_projects})
              round: 0
            m_cost_per_sqm:
              type: number
              label: Cost per sqm
              sql: safe_divide(${m_actual},${m_total_area})
              compact: thousands
              round: 1
      - name: frontage
        description: ""
        meta:
          dimension:
            type: number
