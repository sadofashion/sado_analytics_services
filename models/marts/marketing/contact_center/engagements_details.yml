version: 2
models:
  - name: engagements_details
    description: "Tổng hợp tương tác (gọi & chat) thông qua caresoft"
    meta:
      joins:
        - join: tickets
          sql_on: ${engagements_details.ticket_id} = ${tickets.ticket_id}
        - join: stg_caresoft__contacts
          sql_on: ${engagements_details.customer_id} = ${stg_caresoft__contacts.contact_id}
        - join: calendar
          sql_on: date(${engagements_details.start_time}) = ${calendar.date}
          fields: [date, month_name, year_month, period]
        - join: stg_caresoft__agents
          sql_on: ${stg_caresoft__agents.agent_id} = ${engagements_details.agent_id}
    columns:
      - name: ticket_id
        description: ""
        meta:
          dimension:
            type: number
      - name: customer_id
        description: ""
        meta:
          dimension:
            type: number
        tests:
          - not_null
      - name: service_id
        description: ""
        meta:
          dimension:
            type: number
      - name: start_time
        description: ""
        meta:
          dimension:
            type: timestamp
      - name: end_time
        description: ""
        meta:
          dimension:
            type: timestamp
      - name: agent_id
        description: ""
        meta:
          dimension:
            type: number
        tests:
          - not_null
      - name: engagement_id
        description: ""
        meta:
          dimension:
            type: string
        tests:
          - not_null
          - unique
      - name: engagement_status
        description: ""
        meta:
          dimension:
            type: string
      - name: engagement_type
        description: ""
        meta:
          dimension:
            type: string
      - name: engagement_duration
        description: ""
        meta:
          dimension:
            type: number
          metrics:
            m_avg_duration:
              type: average
              label: Avg Engaged Duration
              round: 1
      - name: wait_duration
        description: ""
        meta:
          dimension:
            type: number
          metrics:
            m_avg_duration:
              type: average
              label: Avg Engaged Duration
              round: 1
      - name: missed_reason
        description: ""
        meta:
          dimension:
            type: string
      - name: engagement_channel
        description: ""
        meta:
          dimension:
            type: string
