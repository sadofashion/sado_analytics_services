version: 2
models:
  - name: fct__post_insights
    meta:
      joins:
        - join: calendar
          sql_on: >-
            date(${fct__post_insights.metric_time}) = ${calendar.date} and
            ${fct__post_insights.aggregate_period} = 'day'
        - join: dim__posts
          sql_on: ${fct__post_insights.post_id} = ${dim__posts.post_id}
        - join: dim__pages
          sql_on: ${fct__post_insights.page_id} = ${dim__pages.page_id}
    columns:
      - name: metric_id
        description: The unique identifier for each metric. This is a primary key.
        meta:
          dimension:
            type: string
            hidden: true
        data_type: string
      - name: post_id
        description: >-
          The unique identifier for each post. This is a foreign key that links
          to the post table.
        meta:
          dimension:
            type: string
            hidden: true
        data_type: string
      - name: metric_name
        description: >-
          The name of the metric. This is a descriptive field that indicates the
          type of metric being recorded.
        meta:
          dimension:
            type: string
        data_type: string
      - name: aggregate_period
        description: >-
          The 'aggregate_period' column represents the time period over which
          the metric is aggregated. This could be daily, weekly, monthly, etc.
        meta:
          dimension:
            type: string
            hidden: true
        data_type: string
      - name: metric_title
        description: >-
          The 'metric_title' column contains the title of the metric being
          reported. This could be any metric related to post insights such as
          'post_engagement', 'post_reach', etc.
        meta:
          dimension:
            type: string
        data_type: string
      - name: metric_description
        description: >-
          The 'metric_description' column provides a detailed description of
          what the metric represents. This helps users understand the context
          and significance of the metric.
        meta:
          dimension:
            type: string
        data_type: string
      - name: metric_time
        description: >-
          The 'metric_time' column represents the timestamp at which the metric
          was recorded. It is of type TIMESTAMP and is in UTC.
        meta:
          dimension:
            type: timestamp
            hidden: true
          additional_dimensions:
            d_days_since_publish:
              type: number
              sql: date_diff(${fct__post_insights.metric_time}, ${dim__posts.created_time},'day')
              label: Days since published
        data_type: timestamp
      - name: metric_value
        description: >-
          The 'metric_value' column represents the value of the metric recorded.
          It is of type FLOAT and can contain decimal values.
        meta:
          dimension:
            type: number
          metrics:
            m_clicks:
              type: sum
              label: Clicks
              compact: thousands
              round: 1
              filters:
                - metric_name: post_clicks
            m_impressions:
              type: sum
              label: Impressions
              compact: thousands
              round: 1
              filters:
                - metric_name: post_impressions
            m_clicks_unique:
              type: sum
              label: Unique Clicks
              compact: thousands
              round: 1
              filters:
                - metric_name: post_clicks_unique
            m_paid_impressions:
              type: sum
              label: Paid Impressions
              compact: thousands
              round: 1
              filters:
                - metric_name: post_impressions_paid
            m_organic_impressions:
              type: sum
              label: Organic Impressions
              compact: thousands
              round: 1
              filters:
                - metric_name: post_impressions_organic
            m_viral_impressions:
              type: sum
              label: Viral Impressions
              compact: thousands
              round: 1
              filters:
                - metric_name: post_impressions_viral
            m_click_rate:
              type: number
              label: Click Rate
              format: percent
              round: 2
              sql: safe_divide(${m_clicks}, ${m_impressions})
            m_paid_click_rate:
              type: number
              label: Paid Click Rate
              format: percent
              round: 2
              sql: safe_divide(${m_clicks}, ${m_paid_impressions})
            m_engaged_users:
              type: sum
              label: Engaged Users
              compact: thousands
              round: 1
              filters:
                - metric_name: post_engaged_users
            m_unique_impressions:
              type: sum
              label: Reach
              compact: thousands
              round: 1
              filters:
                - metric_name: post_impressions_unique
            m_engagement_rate:
              type: number
              label: Engagement Rate
              format: percent
              round: 2
              sql: safe_divide(${m_engaged_users}, ${m_unique_impressions})
            m_video_view_time:
              type: sum
              label: Lifetime View Time
              compact: thousands
              sql: ${TABLE}.metric_value/1000
              round: 1
              filters:
                - metric_name: post_video_view_time
                - aggregate_period: lifetime
            m_avg_view_time:
              type: average
              label: Average View Time
              sql: ${TABLE}.metric_value/1000
              round: 1
              filters: 
                - metric_name: post_video_avg_time_watched
                - aggregate_period: lifetime
            m_video_views:
              type: sum
              label: Lifetime Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views
                - aggregate_period: lifetime
            m_unique_video_views:
              type: sum
              label: Lifetime Unique Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_unique
                - aggregate_period: lifetime
            m_paid_video_views:
              type: sum
              label: Lifetime Paid Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_paid
                - aggregate_period: lifetime
            m_unique_paid_video_views:
              type: sum
              label: Unique Paid Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_paid_unique
            m_video_views_active:
              type: sum
              label: Active Videos Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_clicked_to_play
            m_video_views_autoplayed:
              type: sum
              label: Autoplayed Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_autoplayed
            m_organic_video_views:
              type: sum
              label: Organic Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_organic
            m_unique_organic_video_views:
              type: sum
              label: Unique Organic Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_organic_unique
            m_organic_view_time:
              type: sum
              sql: ${TABLE}.metric_value/1000
              label: Organic View Time
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_view_time_organic
                - aggregate_period: lifetime
            m_daily_video_views:
              type: sum
              label: Daily Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views
                - aggregate_period: daily
            m_daily_unique_video_views:
              type: sum
              label: Daily Unique Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_unique
                - aggregate_period: daily
            m_daily_paid_video_views:
              type: sum
              label: Daily Paid Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_paid
                - aggregate_period: daily
            m_daily_organic_video_views:
              type: sum
              label: Daily Organic Video Views
              compact: thousands
              round: 1
              filters:
                - metric_name: post_video_views_organic
                - aggregate_period: daily
            m_daily_avg_view_time:
              type: average
              label: Daily Average View Time
              sql: ${TABLE}.metric_value/1000
              round: 1
              filters:
                - metric_name: post_video_avg_time_watched
                - aggregate_period: daily
        data_type: float64
      - name: page_id
        description: ""
        meta:
          dimension:
            type: string
            hidden: true
    description: >-
      The model is a fact table that contains metrics related to Facebook post
      insights
