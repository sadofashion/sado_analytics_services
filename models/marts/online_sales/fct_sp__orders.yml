version: 2
models:
  - name: fct_sp__orders
    meta:
      joins:
        - join: calendar
          sql_on: ${fct_sp__orders.transaction_date} = ${calendar.date}
        - join: dim__inventory_classes
          sql_on: ${dim__inventory_classes.class_code} = ${fct_sp__orders.class_code}
    columns:
      - name: order_number
        description: Unique identifier for each order placed
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
          metrics:
            m_num_orders:
              type: count_distinct
              label: Orders
              group_label: Orders
            m_num_completed_orders:
              type: count_distinct
              label: Completed Orders
              group_label: Orders
              filters:
                - order_status: COMPLETED
            m_num_cancelled_orders:
              type: count_distinct
              label: Cancelled Orders
              group_label: Orders
              filters:
                - order_status: CANCELLED
            m_num_shipped_orders:
              type: count_distinct
              label: Shipped Orders
              group_label: Orders
              filters:
                - order_status: SHIPPED
            m_num_pending_orders:
              type: count_distinct
              label: Wait for Confirm Orders
              group_label: Orders
              filters:
                - order_status: TO_CONFIRM_RECEIVE
            m_num_to_return_orders:
              type: count_distinct
              label: Wait for Return Orders
              group_label: Orders
              filters:
                - order_status: TO_RETURN
            m_num_unpaid_orders:
              type: count_distinct
              label: Unpaid Orders
              group_label: Orders
              filters:
                - order_status: UNPAID
            m_num_fulfilled_orders:
              type: number
              sql: ${m_num_completed_orders}+${m_num_shipped_orders}
              label: Fulfilled Orders
              group_label: Orders
            m_num_failed_orders:
              type: number
              sql: ${m_num_cancelled_orders}+${m_num_to_return_orders}
              label: Failed Orders
              group_label: Orders
            m_canceled_rate:
              type: number
              sql: safe_divide(${m_num_cancelled_orders},${m_num_orders})
              label: Canceled Rate
              group_label: Orders
              format: percent
              round: 2
            m_failed_rate:
              type: number
              sql: safe_divide(${m_num_failed_orders},${m_num_orders})
              label: Failed Rate
              group_label: Orders
              format: percent
              round: 2
      - name: order_status
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
      - name: cancel_by
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
      - name: cancel_reason
        description: This field provides the reason for the cancellation of an order
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
      - name: transaction_date
        data_type: date
        quote: true
        meta:
          dimension:
            type: date
            hidden: true
      - name: payment_method
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
      - name: add_on_deal
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
      - name: add_on_deal_id
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: item_id
        description: Unique identifier for the item that was purchased in the order
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: item_name
        description: The name of the item that was purchased in the order
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
      - name: item_sku
        description: Stock Keeping Unit (SKU) of the item that was purchased
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: main_item
        description: Indicates whether the item is the main item in the order or an add-on
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
      - name: model_id
        description: The unique identifier for the product model
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: model_name
        description: The name of the product model
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
      - name: model_discounted_price
        description: The price of the product model after any discounts have been applied
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
          metrics:
            m_item_value:
              type: sum
              label: Item Sold Value
              group_label: Orders
              compact: millions
              round: 1
            m_item_collected_value:
              type: sum
              label: Collected Item Value
              group_label: Orders
              compact: millions
              round: 1
              filters:
                - order_status: COMPLETED
            m_discounted_value:
              type: sum
              label: Discounted Value
              sql: ${TABLE}.model_original_price-${TABLE}.model_discounted_price
              group_label: Orders
            m_aov:
              type: number
              sql: safe_divide(${m_item_collected_value},${m_num_completed_orders})
              round: 2
              group_label: Orders
              label: AOV
              compact: thousands
              description: Average Order Value
            m_ausp:
              type: number
              sql: safe_divide(${m_item_collected_value},${m_quantity_sold_completed})
              round: 2
              group_label: Orders
              compact: thousands
              label: AUSP
              description: Average Unit Selling Price
      - name: model_original_price
        description: This field represents the original price of the product model
          before any discounts or promotions are applied
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
          metrics:
            m_item_original_value:
              type: sum
              label: Item Original Value
              group_label: Orders
              compact: millions
              round: 1
      - name: model_quantity_purchased
        description: Indicates the quantity of a particular product model that was
          purchased in a single order
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
          metrics:
            m_quantity_sold:
              type: sum
              label: Quantity Sold
              group_label: Orders
            m_quantity_sold_completed:
              type: sum
              label: Quantity Sold Completed
              group_label: Orders
              filters:
                - order_status: COMPLETED
            m_quantity_per_order:
              type: number
              sql: safe_divide(${m_quantity_sold_completed},${m_num_completed_orders})
              label: Quantity per Order
              group_label: Orders
              round: 2
            m_quantity_sold_main:
              type: sum
              label: Quantity Sold Main
              group_label: Orders
              filters:
                - main_item: "true"
            m_quantity_sold_add_on:
              type: sum
              label: Quantity Sold Add On
              group_label: Orders
              filters:
                - main_item: "false"
            m_quantity_sold_cancelled:
              type: sum
              label: Quantity Sold Cancelled
              group_label: Orders
              filters:
                - order_status: CANCELLED
            m_quantity_sold_return:
              type: sum
              label: Quantity Sold Return
              group_label: Orders
              filters:
                - order_status: TO_RETURN
            m_lost_quantity_sold:
              type: number
              sql: ${m_quantity_sold_cancelled}+${m_quantity_sold_return}
              label: Lost Quantity Sold
              group_label: Orders
            m_lost_sold_rate:
              type: number
              sql: safe_divide(${m_lost_quantity_sold},${m_quantity_sold})
              label: Lost Sold Rate
              group_label: Orders
              format: percent
              round: 2
      - name: model_sku
        description: Stock Keeping Unit (SKU) of the product model
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: order_item_id
        description: Unique identifier for each item in an order
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: promotion_group_id
        description: Unique identifier for a group of promotions
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: promotion_id
        description: Unique identifier for each promotion
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: line_amount
        data_type: float64
        quote: true
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_line_amount:
              type: sum
              label: Order Total Amount
              group_label: Orders
              compact: millions
              round: 1
            m_order_discount:
              type: number
              sql: ${m_line_amount}-${m_item_value}
              label: Order Discount
              group_label: Orders
            m_revenue:
              type: sum
              label: Collected Revenue
              group_label: Orders
              compact: millions
              round: 1
              filters:
                - order_status: COMPLETED
            m_revenue_shipped:
              type: sum
              label: Revenue (Shipped)
              group_label: Orders
              compact: millions
              round: 1
              filters:
                - order_status: SHIPPED
            m_revenue_wait_for_confirm:
              type: sum
              label: Revenue (Wait for Confirm)
              group_label: Orders
              compact: millions
              round: 1
              filters:
                - order_status: TO_CONFIRM_RECEIVE
            m_pending_revenue:
              type: number
              sql: ${m_revenue_shipped}+${m_revenue_wait_for_confirm}
              label: Pending Revenue
              group_label: Orders
              compact: millions
              round: 1
            m_lost_revenue_to_return:
              type: sum
              label: Wait for return Revenue
              group_label: Orders
              compact: millions
              round: 1
              filters:
                - order_status: TO_RETURN
            m_lost_revenue_cancelled:
              type: sum
              label: Cancelled Revenue
              group_label: Orders
              compact: millions
              round: 1
              filters:
                - order_status: CANCELLED
            m_lost_revenue:
              type: number
              sql: ${m_lost_revenue_to_return}+${m_lost_revenue_cancelled}
              label: Lost Revenue
              group_label: Orders
              compact: millions
              round: 1
      - name: product_code
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: class_code
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
            hidden: true
      - name: promotion_type
        description: The type of promotion applied to the order
        data_type: string
        quote: true
        meta:
          dimension:
            type: string
