version: 2 
models:
  - name: online_inventory_balance
    description: ""
    columns:
      - name: product_id
        description: ""

      - name: date
        description: ""

      - name: daily_ending_remain
        description: ""

      - name: daily_beginning_remain
        description: ""

      - name: daily_ending_available
        description: ""

      - name: daily_beginning_available
        description: ""

      - name: daily_qty_sold
        description: ""

      - name: daily_average_remain
        description: ""

      - name: daily_average_available
        description: ""

semantic_models:
  - name: online_inventory_balance
    defaults:
      agg_time_dimension: date
    description: 
    model: ref('online_inventory_balance')
    entities:
      - name: product_date
        type: primary
        expr: concat(product_id,'.',unix_date(date))
      - name: product
        expr: product_id
        type: foreign
    dimensions:
      - name: depot
        expr: depot_name,
        type: categorical
      - name: date
        expr: date
        type: time
        type_params:
          time_granularity: day
    measures:
      - name: onl_dly_avg_remain
        expr: daily_average_remain
        agg: average
      - name: onl_dly_avg_qty_sold
        expr: daily_qty_sold
        agg: average
      - name: onl_dly_total_qty_sold
        expr: daily_qty_sold
        agg: sum
metrics:
  - name: onl_dly_avg_inv_7d
    label: Online Daily Average Inventory 7D
    type: cumulative
    type_params:
      measure: onl_dly_avg_remain
      window: 7 days
  - name: onl_dly_avg_qty_sold_7d
    label: Online QTY sold 7D
    type: cumulative
    type_params:
      measure: onl_dly_avg_qty_sold
      window: 7 days
  - name: onl_dly_total_qty_sold_7d
    label: Online QTY sold 7D
    type: cumulative
    type_params:
      measure: onl_dly_total_qty_sold
      window: 7 days
  - name: onl_inv_dio_7d
    label: Online DIO
    type: derived
    type_params:
      expr: (remain/total_sales)*7
      metrics:
        - name: onl_dly_avg_inv_7d
          alias: remain
        - name: onl_dly_total_qty_sold_7d
          alias: total_sales
  - name: onl_inv_turnover
    label: Online Inventory Turnover
    type: derived
    type_params:
      expr: (qty_sold/remain)
      metrics:
        - name: onl_dly_total_qty_sold_7d
          alias: qty_sold
        - name: onl_dly_avg_inv_7d
          alias: remain
