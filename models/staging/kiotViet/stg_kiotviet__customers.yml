version: 2
models:
  - name: stg_kiotviet__customers
    description: customers fact table
    meta:
      joins:
        - join: dim__branches
          sql_on: ${dim__branches.branch_id} = ${stg_kiotviet__customers.branch_id}
    columns:
      - name: customer_id
        description: ID khách hàng trên Kiot
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_no_customers:
              type: count_distinct
              label: Number of customers
              group_label: Customer Metrics
              compact: thousands
              round: 1
        data_type: numeric
      - name: customer_name
        meta:
          dimension:
            type: string
            hidden: true
        data_type: string
      - name: gender
        description: true = Nam, false = Nữ, Null = Chưa xác định
        meta:
          dimension:
            type: boolean
        data_type: boolean
      - name: birth_month
        description: Tháng sinh nhật
        meta:
          dimension:
            type: number
        data_type: int64
      - name: birth_date
        meta:
          dimension:
            type: timestamp
          metrics:
            m_bday:
              type: count
              label: num_bday
              group_label: Customer Metrics
        data_type: timestamp
      - name: contact_number
        description: Số điện thoại
        meta:
          dimension:
            type: string
            hidden: true
          metrics:
            m_num_phones:
              type: count_distinct
              label: No. Phones
              group_label: Customer Metrics
              compact: thousands
              round: 1
        data_type: string
      - name: branch_id
        description: ID Cửa hàng trên Kiot
        meta:
          dimension:
            type: number
            hidden: true
        data_type: numeric
      - name: customer_type
        meta:
          dimension:
            type: number
        data_type: numeric
      - name: customer_groups
        meta:
          dimension:
            type: string
            sql: >
              case 
                when lower(customer_groups) like '%bạc%' then 'Hạng Bạc'
                when lower(customer_groups) like '%vàng%' then 'Hạng Vàng'
                when lower(customer_groups) like '%kim cương%' then 'Hạng Kim Cương'
                when lower(customer_groups) like '%vip%' then 'Hạng VIP'
                else 'Hạng thường' end
        data_type: string
      - name: debt
        meta:
          dimension:
            type: number
            hidden: true
        data_type: float64
      - name: total_invoiced
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_avg_invoiced:
              type: average
              label: Avg Invoiced Value
              group_label: Customer Metrics
              compact: millions
              round: 1
        data_type: float64
      - name: total_point
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_total_points:
              type: sum
              label: Total Points
              group_label: Customer Metrics
              compact: thousands
              round: 1
        data_type: numeric
      - name: total_revenue
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_avg_revenue:
              type: average
              label: Avg Revenue
              group_label: Customer Metrics
              compact: millions
              round: 1
        data_type: numeric
      - name: rewardpoint
        meta:
          dimension:
            type: number
            hidden: true
          metrics:
            m_rewarded_points:
              type: sum
              label: Total Rewarded Points
              group_label: Customer Metrics
              compact: thousands
              round: 1
        data_type: numeric
      - name: created_date
        description: Ngày tạo
        meta:
          dimension:
            type: timestamp
            hidden: true
        data_type: timestamp
      - name: branch_name
        description: Tên cửa hàng trên Kiot
        meta:
          dimension:
            type: string
        data_type: string
      - name: modified_date
        data_type: timestamp
        quote: true
      - name: customer_recency_group
        meta:
          dimension:
            type: string
            hidden: true
        data_type: string
